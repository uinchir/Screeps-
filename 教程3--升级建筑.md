## æ•™ç¨‹3--å‡çº§å»ºç­‘

### 3.1

æ§åˆ¶å™¨å‡çº§è§£é”äº†æ–°çš„å»ºç­‘ï¼šwallã€rampart ä»¥åŠ extensionã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸ªæ•™ç¨‹éƒ¨åˆ†è®¨è®º wall å’Œ rampartï¼Œç°åœ¨è®©æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ extensionã€‚

**Extension** è¢«ç”¨æ¥å­µåŒ–æ›´å¤§å‹çš„ creepã€‚æ¯ç§èº«ä½“ç±»å‹åªæœ‰ä¸€ä¸ªéƒ¨ä»¶çš„ creep å·¥ä½œå¹¶ä¸é«˜æ•ˆã€‚å¤šä¸ºå…¶æ·»åŠ å‡ ä¸ª `WORK` éƒ¨ä»¶å¯ä»¥è®©å®ƒä»¬æˆæ¯”ä¾‹çš„æé«˜æ•ˆç‡ã€‚

ä½†æ˜¯ï¼Œè¿™æ ·çš„ creep ä¼šæ›´åŠ çš„æ˜‚è´µï¼Œå¹¶ä¸”å•ç‹¬ä¸€ä¸ª spawn åªèƒ½å®¹çº³æœ€å¤š 300 ç‚¹èƒ½é‡ã€‚æƒ³è¦å­µåŒ–æˆæœ¬è¶…è¿‡ 300 ç‚¹èƒ½é‡çš„ creepï¼Œæ‚¨éœ€è¦ spawn æ‹“å±•ï¼ˆå³ extensionï¼‰ã€‚

äºŒçº§ controller å°†å…è®¸æ‚¨å»ºé€  **5 ä¸ª extension**ã€‚æ¯æ¬¡ controller å‡çº§éƒ½ä¼šè§£é”æ›´å¤šçš„ extensionã€‚

æ‚¨å¯ä»¥åœ¨æ‚¨æˆ¿é—´ä¸­çš„ä»»ä½•ä½ç½®æ”¾ç½® extensionï¼Œå¹¶ä¸” spawn å¯ä»¥æ— è§†å½¼æ­¤ä¹‹é—´çš„è·ç¦»ç›´æ¥ä½¿ç”¨ extension ä¸­çš„èƒ½é‡ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬å·²ç»æ”¾ç½®å¥½äº†å¯¹åº”çš„å»ºç­‘å·¥åœ°ï¼ˆconstruction siteï¼‰ã€‚

### 3.2

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç”¨äºå»ºé€ å»ºç­‘çš„æ–° creepã€‚è¿™ä¸ªè¿‡ç¨‹å’Œä¹‹å‰çš„æ•™ç¨‹ç« èŠ‚ç±»ä¼¼ã€‚ä½†æ˜¯è¿™æ¬¡æˆ‘ä»¬å°†ä½¿ç”¨ `Spawn.spawnCreep`æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ç›´æ¥ä¸ºæ–°çš„ creep è®¾ç½® `memory`ã€‚

å­µåŒ–ä¸€ä¸ªèº«ä½“éƒ¨ä»¶ä¸º `[WORK,CARRY,MOVE]`ï¼Œåå­—ä¸º `Builder1`ï¼Œå¹¶ä¸”å†…å­˜ä¸º `{role:'builder'}` çš„ creepã€‚

æ–‡æ¡£ï¼š

- [StructureSpawn.spawnCreep](https://screeps-cn.gitee.io/api/#StructureSpawn.spawnCreep)

```
Game.spawns['Spawn1'].spawnCreep( [WORK, CARRY, MOVE], 'Builder1',
    { memory: { role: 'builder' } } );
```

### 3.3

å’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªè§’è‰²æ”¾åˆ°å•ç‹¬çš„æ¨¡å— `role.builder` ä¸­ã€‚å»ºé€ æ˜¯é€šè¿‡å¯¹å»ºç­‘å·¥åœ°æ‰§è¡Œ `Creep.build` æ–¹æ³•è¿›è¡Œçš„ï¼Œè€Œå·¥åœ°åˆ™å¯ä»¥é€šè¿‡ `Room.find(FIND_CONSTRUCTION_SITES)` æœç´¢å¾—åˆ°ã€‚å»ºé€ å»ºç­‘éœ€è¦èƒ½é‡ï¼Œæ‚¨çš„ creep åº”è¯¥è‡ªå·±å»é‡‡é›†å®ƒä»¬ã€‚

ä¸ºäº†é¿å…ç”±äºèº«ä¸Šèµ„æºè€—å°½è€Œé¢‘ç¹çš„æ¥å›ç§»åŠ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡æ·»åŠ ä¸€ä¸ªæ–°çš„å¸ƒå°”å˜é‡ `creep.memory.building` æ¥å¢å¼ºä¸€ä¸‹ä»£ç ï¼Œè¿™ä¸ªå˜é‡å°†ä¼šå‘Šè¯‰ creep åº”è¯¥ä½•æ—¶åˆ‡æ¢ä»»åŠ¡ã€‚æˆ‘ä»¬è¿˜è°ƒç”¨äº† `creep.say` å¹¶ä¸”åœ¨ `moveTo` æ–¹æ³•ä¸­æ·»åŠ äº† `visualizePathStyle` é€‰é¡¹æ¥å¯è§†åŒ– creep çš„ç§»åŠ¨è·¯å¾„ã€‚

åˆ›å»ºä¸€ä¸ªåä¸º `role.builder` çš„æ¨¡å—ï¼Œå¹¶å†™å…¥æ–° creep çš„è¡Œä¸ºé€»è¾‘ã€‚

æ–‡æ¡£ï¼š

- [RoomObject.room](https://screeps-cn.gitee.io/api/#RoomObject.room)
- [Room.find](https://screeps-cn.gitee.io/api/#Room.find)
- [Creep.build](https://screeps-cn.gitee.io/api/#Creep.build)
- [Creep.say](https://screeps-cn.gitee.io/api/#Creep.say)

```
var roleBuilder = {

    /** @param {Creep} creep **/
    run: function(creep) {

	    if(creep.memory.building && creep.store[RESOURCE_ENERGY] == 0) {
            creep.memory.building = false;
            creep.say('ğŸ”„ harvest');
	    }
	    if(!creep.memory.building && creep.store.getFreeCapacity() == 0) {
	        creep.memory.building = true;
	        creep.say('ğŸš§ build');
	    }

	    if(creep.memory.building) {
	        var targets = creep.room.find(FIND_CONSTRUCTION_SITES);
            if(targets.length) {
                if(creep.build(targets[0]) == ERR_NOT_IN_RANGE) {
                    creep.moveTo(targets[0], {visualizePathStyle: {stroke: '#ffffff'}});
                }
            }
	    }
	    else {
	        var sources = creep.room.find(FIND_SOURCES);
            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) {
                creep.moveTo(sources[0], {visualizePathStyle: {stroke: '#ffaa00'}});
            }
	    }
	}
};

module.exports = roleBuilder;
```

### 3.4

è®©æˆ‘ä»¬åœ¨ main æ¨¡å—ä¸­å¼•ç”¨æ–°çš„è§’è‰²å¹¶ç§ç§ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

é€šè¿‡åœ¨æ–° creep ä¸Šåº”ç”¨ `role.builder` æ¨¡å—æ¥å»ºé€ å…¨éƒ¨ 5 ä¸ª extensionã€‚

```
var roleHarvester = require('role.harvester');
var roleBuilder = require('role.builder');

module.exports.loop = function () {

    for(var name in Game.creeps) {
        var creep = Game.creeps[name];
        if(creep.memory.role == 'harvester') {
            roleHarvester.run(creep);
        }
        if(creep.memory.role == 'builder') {
            roleBuilder.run(creep);
        }
    }
}
```

### 3.5

æƒ³è¦ç»´æŠ¤ extensionï¼Œæ‚¨éœ€è¦æ•™ä¼šæ‚¨çš„é‡‡é›†å•ä½æŠŠèƒ½é‡è¿è¾“åˆ° extension è€Œä¸ä»…ä»…æ˜¯ spawnã€‚ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ `Game.structures` å¯¹è±¡æˆ–è€…åœ¨å¯¹åº”çš„æˆ¿é—´æ‰§è¡Œ `Room.find(FIND_STRUCTURES)` æ–¹æ³•è¿›è¡Œæœç´¢ã€‚æ— è®ºä½¿ç”¨å“ªç§æ–¹å¼ï¼Œæ‚¨éƒ½éœ€è¦ç”¨åˆ¤æ–­æ¡ä»¶ `structure.structureType == STRUCTURE_EXTENSION`ï¼ˆæˆ–è€… `structure instanceof StructureExtension`ï¼‰å¯¹ç»“æœåˆ—è¡¨è¿›è¡Œç­›é€‰ï¼Œè¿˜æœ‰åˆ«å¿˜äº†æ£€æŸ¥å®ƒä»¬å­˜æœ‰å¤šå°‘èƒ½é‡ï¼ˆå°±åƒä¹‹å‰æ£€æŸ¥ creep ä¸€æ ·ï¼‰ã€‚

ä¼˜åŒ– `role.harvester` æ¨¡å—ä¸­çš„é€»è¾‘ã€‚

æ–‡æ¡£ï¼š

- [Game.structures](https://screeps-cn.gitee.io/api/#Game.structures)
- [Room.find](http://docs.screeps.com/api/#Room.find)
- [StructureExtension](https://screeps-cn.gitee.io/api/#StructureExtension)

```
var roleHarvester = {

    /** @param {Creep} creep **/
    run: function(creep) {
	    if(creep.store.getFreeCapacity() > 0) {
            var sources = creep.room.find(FIND_SOURCES);
            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) {
                creep.moveTo(sources[0], {visualizePathStyle: {stroke: '#ffaa00'}});
            }
        }
        else {
            var targets = creep.room.find(FIND_STRUCTURES, {
                    filter: (structure) => {
                        return (structure.structureType == STRUCTURE_EXTENSION || structure.structureType == STRUCTURE_SPAWN) &&
                            structure.store.getFreeCapacity(RESOURCE_ENERGY) > 0;
                    }
            });
            if(targets.length > 0) {
                if(creep.transfer(targets[0], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {
                    creep.moveTo(targets[0], {visualizePathStyle: {stroke: '#ffffff'}});
                }
            }
        }
	}
};

module.exports = roleHarvester;
```

### 3.5

æƒ³è¦äº†è§£æˆ¿é—´é‡Œæ€»å…±æœ‰å¤šå°‘èƒ½é‡å¯ä»¥ç”¨äºå­µåŒ–ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `Room.energyAvailable` å±æ€§ã€‚è®©æˆ‘ä»¬æŠŠè¿™ä¸ªå±æ€§è¾“å‡ºåˆ°æ§åˆ¶å°ä¸­ä»¥ä¾¿åœ¨ extension å¡«å……æœŸé—´å¯¹å…¶è¿›è¡Œè¿½è¸ªã€‚

æ‰¾åˆ°å…¨éƒ¨çš„ 5 ä¸ª extension ä»¥åŠ spawn å¹¶å¡«å……èƒ½é‡ã€‚

æ–‡æ¡£ï¼š

- [Room.energyAvailable](https://screeps-cn.gitee.io/api/#Room.energyAvailable)

```
var roleHarvester = require('role.harvester');
var roleBuilder = require('role.builder');

module.exports.loop = function () {

    for(var name in Game.rooms) {
        console.log('Room "'+name+'" has '+Game.rooms[name].energyAvailable+' energy');
    }

    for(var name in Game.creeps) {
        var creep = Game.creeps[name];
        if(creep.memory.role == 'harvester') {
            roleHarvester.run(creep);
        }
        if(creep.memory.role == 'builder') {
            roleBuilder.run(creep);
        }
    }
}
```

### 3.6

ç°åœ¨æˆ‘ä»¬çš„ spawn å’Œ extension ä¸­æ€»å…±æœ‰ 550 ç‚¹èƒ½é‡ã€‚è¿™å·²ç»è¶³å¤Ÿå»ºé€ ä¸€ä¸ªèº«ä½“éƒ¨ä»¶ä¸º `[WORK,WORK,WORK,WORK,CARRY,MOVE,MOVE]` çš„ creep äº†ã€‚è¿™ä¸ª creep çš„æ•ˆç‡æ˜¯æ™®é€šå·¥ä½œå•ä½çš„ 4 å€ã€‚ä½†æ˜¯è¿™ä¹Ÿè®©å®ƒå˜å¾—æ›´é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™å®ƒæ·»åŠ äº†é¢å¤–çš„ `MOVE` éƒ¨ä»¶ã€‚ä½†æ˜¯ï¼Œä¸¤ä¸ª `MOVE` ä¹Ÿæ²¡åŠæ³•è®©å®ƒè·‘å¾—åƒå° creep é‚£æ ·å¿«ï¼Œé™¤éæˆ‘ä»¬ç»™ä»–æ·»åŠ  4 ä¸ª `MOVE` æˆ–è€…ä¿®ä¸€æ¡è·¯ã€‚

å­µåŒ–ä¸€ä¸ªèº«ä½“éƒ¨ä»¶ä¸º `[WORK,WORK,WORK,CARRY,MOVE,MOVE]`ï¼Œåç§°ä¸º `HarvesterBig` çš„ creep å¹¶ä¸”è®¾ä¸º `harvester` è§’è‰²ã€‚

```
Game.spawns['Spawn1'].spawnCreep( [WORK,WORK,WORK,WORK,CARRY,MOVE,MOVE],
    'HarvesterBig',
    { memory: { role: 'harvester' } } );
```

ç»“æŸ